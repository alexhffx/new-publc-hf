---
import PageLayout from '../../layouts/PageLayout.astro';
import Hero from '../../components/Hero.astro';
import { getWebinars, urlFor } from '../../lib/sanity';

const allWebinars = await getWebinars();
const now = new Date();

const upcoming = (allWebinars || []).filter((w: any) => new Date(w.eventDate) > now);
const past = (allWebinars || []).filter((w: any) => new Date(w.eventDate) <= now);
---

<PageLayout title="Webinars & Events" description="Free webinars on treasury, FX, and international finance from HedgeFlows.">
  <Hero
    title="Webinars & Events"
    subtitle="Join our treasury experts for free educational webinars on FX, cash management, and international finance."
  />

  {/* Upcoming */}
  {upcoming.length > 0 && (
    <section class="section-padding">
      <div class="container-content">
        <h2 class="section-heading mb-10">Upcoming events</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
          {upcoming.map((w: any) => (
            <a
              href={`/webinars/${w.slug?.current}`}
              class="group block bg-white rounded-xl border border-gray-100 overflow-hidden
                     shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                     hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                     transition-all duration-300"
            >
              {w.thumbnail && (
                <img
                  src={urlFor(w.thumbnail).width(700).height(350).auto('format').url()}
                  alt=""
                  class="w-full aspect-[2/1] object-cover group-hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                />
              )}
              <div class="p-6 md:p-7">
                <span class="inline-block px-3 py-1 bg-brand-green text-white text-[0.75rem] font-bold rounded-full mb-3">
                  Upcoming
                </span>
                <p class="text-[0.8125rem] font-medium text-text-muted mb-2">
                  {new Date(w.eventDate).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                </p>
                <h3 class="text-[1.25rem] font-semibold text-text-heading group-hover:text-brand-green transition-colors leading-snug mb-2">
                  {w.title}
                </h3>
                {w.description && (
                  <p class="text-[0.9375rem] text-text-body leading-relaxed line-clamp-2">{w.description}</p>
                )}
                {w.speakers && w.speakers.length > 0 && (
                  <p class="text-[0.8125rem] text-text-muted mt-3">
                    Speakers: {w.speakers.map((s: any) => s.name).join(', ')}
                  </p>
                )}
              </div>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  {/* Past */}
  <section class:list={['section-padding', upcoming.length > 0 ? 'bg-[#F8FAFB]' : '']}>
    <div class="container-content">
      {past.length > 0 ? (
        <>
          <h2 class="section-heading mb-10">{upcoming.length > 0 ? 'Past events' : 'Webinars & recordings'}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
            {past.map((w: any) => (
              <a
                href={`/webinars/${w.slug?.current}`}
                class="group block bg-white rounded-xl border border-gray-100 overflow-hidden
                       shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                       hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                       transition-all duration-300"
              >
                {w.thumbnail ? (
                  <img
                    src={urlFor(w.thumbnail).width(600).height(375).auto('format').url()}
                    alt=""
                    class="w-full aspect-[16/10] object-cover group-hover:scale-105 transition-transform duration-500"
                    loading="lazy"
                  />
                ) : (
                  <div class="w-full aspect-[16/10] bg-gradient-to-br from-brand-green-pale to-brand-green/10 flex items-center justify-center">
                    <svg class="w-12 h-12 text-brand-green/30" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z" />
                    </svg>
                  </div>
                )}
                <div class="p-5">
                  <p class="text-[0.8125rem] font-medium text-text-muted mb-2">
                    {new Date(w.eventDate).toLocaleDateString('en-GB', { year: 'numeric', month: 'short', day: 'numeric' })}
                  </p>
                  <h3 class="text-[1.0625rem] font-semibold text-text-heading group-hover:text-brand-green transition-colors leading-snug">
                    {w.title}
                  </h3>
                  {w.recordingUrl && (
                    <span class="inline-flex items-center gap-1 text-brand-green text-[0.8125rem] font-medium mt-2">
                      <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                      Watch recording
                    </span>
                  )}
                </div>
              </a>
            ))}
          </div>
        </>
      ) : upcoming.length === 0 ? (
        <div class="text-center py-12">
          <p class="text-text-muted text-lg">No webinars yet. Check back soon!</p>
        </div>
      ) : null}
    </div>
  </section>
</PageLayout>
