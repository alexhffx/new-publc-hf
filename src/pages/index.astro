---
import PageLayout from '../layouts/PageLayout.astro';
import HomeHero from '../components/HomeHero.astro';
import TrustBar from '../components/TrustBar.astro';
import StepProcess from '../components/StepProcess.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import BlogCard from '../components/BlogCard.astro';
import CTASection from '../components/CTASection.astro';
import { getTestimonials, getClientLogos, urlFor } from '../lib/sanity';
import { getCollection } from 'astro:content';
import { staticClientLogos } from '../data/clientLogos';
import { xeroStats, getReviewsByTag } from '../data/xeroReviews';

const homepageReviews = getReviewsByTag('homepage').slice(0, 4);

// Fetch real blog posts from Markdown content collection
const mdEntries = await getCollection('blog');
const latestPosts = mdEntries
  .map((entry) => ({
    title: entry.data.title,
    excerpt: entry.data.description || '',
    date: entry.data.date,
    href: `/blog/${entry.data.slug}`,
    image: entry.data.featuredImage || undefined,
  }))
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 3);

// Fetch from Sanity with fallbacks
let sanityTestimonials: any[] = [];
let clientLogos: any[] = [];
try {
  sanityTestimonials = await getTestimonials(true) || [];
} catch (e) { /* fallback to hardcoded */ }
try {
  const sanityLogos = await getClientLogos() || [];
  clientLogos = sanityLogos.length > 0 ? sanityLogos : staticClientLogos;
} catch (e) {
  clientLogos = staticClientLogos;
}

const steps = [
  {
    number: 1,
    title: 'Book a Treasury Review',
    description: '30 minutes. We map your setup, identify where you\'re overpaying, and agree priorities.',
  },
  {
    number: 2,
    title: 'Get your recommendations',
    description: 'Clear priorities: what to fix first, what it\'s worth, and what can wait.',
  },
  {
    number: 3,
    title: 'Connect your data',
    description: 'Link your accounting system and get real-time visibility into FX exposure, cash positions, and payment flows.',
  },
  {
    number: 4,
    title: 'Execute in one click',
    description: 'Act on recommendations directly in the platform — hedges, payments, reporting.',
  },
];

const testimonials = [
  {
    quote: "We switched to HedgeFlows from Wise for international payment runs, and we haven't looked back. The Xero integration works flawlessly, taking care of reconciliations and saving us hours every week.",
    personName: 'Michal Jahns',
    personRole: 'Finance Manager',
    companyName: 'E-commerce company',
  },
  {
    quote: "The Hedgeflows team have been instrumental in helping us to develop our treasury strategy and guiding us through its implementation. We really appreciated that they did not try to 'sell' us their platform or services over other providers, but instead helped us find the best solution for our bespoke needs.",
    personName: 'Harry Young',
    personRole: 'Global Finance Director',
    companyName: 'Journey',
  },
  {
    quote: "We had been spending incredible amounts on bank fees for foreign payments. HedgeFlows has already saved us hundreds in just a couple of transactions. The system is incredibly easy to use.",
    personName: 'Sophie Dale',
    personRole: 'Finance Manager',
    companyName: 'International business',
  },
];

---

<PageLayout
  title="HedgeFlows — Treasury Advisory & Technology"
  description="Expert treasury advisory and technology for businesses that trade internationally. FX risk management, cash management, and payments automation — without the cost of a full treasury function."
>
  <!-- Section 1: Hero -->
  <HomeHero
    title="Unlock global treasury expertise — and the platform to act on it"
    subtitle="So your finance team can handle the FX risk, cross-border complexity, and board questions that come with international growth."
    primaryCta={{ label: 'Book a Treasury Review', href: '/treasury-health-check' }}
    secondaryCta={{ label: 'See the Platform', href: '/platform' }}
  />

  <!-- Section 2: Trust Bar (slider) -->
  <TrustBar label="Trusted by international businesses:" logos={clientLogos} slider={true} />

  <!-- Section 3: Product Suite — Advisory + Platform -->
  <section class="section-padding bg-[#F8FAFB]">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">
          A complete treasury function — without the full-time headcount
        </h2>
        <p class="section-subheading mx-auto">
          Expert advisory and purpose-built technology, working together.
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 lg:gap-8">
        <!-- Card 1: Treasury Advisory -->
        <a href="/treasury-advisory"
           class="group relative bg-white rounded-2xl border border-gray-100 overflow-hidden
                  shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                  hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                  hover:border-brand-green/20 transition-all duration-300 flex flex-col">
          <div class="p-8 lg:p-10 flex-1">
            <p class="text-[0.75rem] font-semibold text-brand-green uppercase tracking-wider mb-3">Treasury Advisory</p>
            <h3 class="text-[1.5rem] lg:text-[1.75rem] font-bold text-text-heading mb-3 leading-tight group-hover:text-brand-green transition-colors duration-200">
              Institutional-grade expertise for your business
            </h3>
            <p class="text-[0.9375rem] text-text-body leading-relaxed mb-6">
              Our advisors have managed treasury for the world's largest companies. Now they work for you — uncovering hidden costs, building hedging strategies, and optimising your banking relationships.
            </p>
            <ul class="space-y-3 mb-8">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">FX risk management & hedging programmes</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Bank relationship & cost optimisation</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Cash management & working capital</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Treasury policy & board-ready reporting</span>
              </li>
            </ul>
            <span class="inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] group-hover:gap-2.5 transition-all duration-200">
              Explore advisory
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </span>
          </div>
          <div class="mx-8 lg:mx-10 mb-8 lg:mb-10 rounded-xl overflow-hidden">
            <img
              src="/assets/images/advisory-team.jpg"
              alt="HedgeFlows treasury advisory team presenting at a client workshop"
              class="w-full h-48 lg:h-56 object-cover"
              loading="lazy"
            />
          </div>
        </a>

        <!-- Card 2: Treasury Platform -->
        <a href="/platform"
           class="group relative bg-white rounded-2xl border border-gray-100 overflow-hidden
                  shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                  hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                  hover:border-brand-green/20 transition-all duration-300 flex flex-col">
          <div class="p-8 lg:p-10 flex-1">
            <p class="text-[0.75rem] font-semibold text-brand-green uppercase tracking-wider mb-3">Treasury Platform</p>
            <h3 class="text-[1.5rem] lg:text-[1.75rem] font-bold text-text-heading mb-3 leading-tight group-hover:text-brand-green transition-colors duration-200">
              See, manage, and act — in one place
            </h3>
            <p class="text-[0.9375rem] text-text-body leading-relaxed mb-6">
              Connect your accounting system and get real-time visibility into FX exposure, cash positions, and payment flows. Then act on expert recommendations directly in the platform.
            </p>
            <ul class="space-y-3 mb-8">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">FX exposure tracking & automated hedging</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Multi-currency payments & collections</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Cash position dashboard across all accounts</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Xero, NetSuite, QuickBooks & Business Central</span>
              </li>
            </ul>
            <span class="inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] group-hover:gap-2.5 transition-all duration-200">
              Explore platform
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </span>
          </div>
          <div class="mx-8 lg:mx-10 mb-8 lg:mb-10 rounded-xl overflow-hidden">
            <img
              src="/assets/images/dashboard.png"
              alt="HedgeFlows treasury dashboard showing cash positions, FX exposure, and payment flows"
              class="w-full h-auto"
              loading="lazy"
            />
          </div>
        </a>
      </div>
    </div>
  </section>

  <!-- Section 4: How It Works -->
  <section class="section-padding bg-[#F8FAFB]">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">How it works</h2>
      </div>
      <StepProcess steps={steps} />
    </div>
  </section>

  <!-- Section 5: Featured Testimonials -->
  <section class="section-padding">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">Trusted by finance leaders</h2>
      </div>
      <div class="grid md:grid-cols-3 gap-8">
        {testimonials.map((t) => (
          <div class="bg-white rounded-2xl border border-gray-100 p-8 shadow-sm flex flex-col">
            <svg class="w-8 h-8 text-brand-green/20 mb-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10H14.017zM0 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151C7.546 6.068 5.983 8.789 5.983 11H10v10H0z" />
            </svg>
            <p class="text-[0.9375rem] text-text-body leading-relaxed flex-1 mb-6">
              {t.quote}
            </p>
            <div class="border-t border-gray-100 pt-4">
              <p class="text-[0.9375rem] font-semibold text-text-heading">{t.personName}</p>
              <p class="text-[0.8125rem] text-text-muted">{t.personRole}, {t.companyName}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Section 6: Xero Reviews Social Proof -->
  <section class="section-padding">
    <div class="container-content">
      <!-- Header with Xero badge -->
      <div class="text-center mb-14">
        <div class="inline-flex items-center gap-3 bg-[#F8FAFB] border border-gray-100 rounded-full px-5 py-2.5 mb-6">
          <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" fill="none">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="#13B5EA"/>
            <path d="M8.5 9.5l3.5 3.5 3.5-3.5M8.5 14.5l3.5-3.5 3.5 3.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div class="flex items-center gap-1.5">
            {[...Array(5)].map(() => (
              <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
          </div>
          <span class="text-[0.875rem] font-semibold text-text-heading">{xeroStats.rating}/5</span>
          <span class="text-[0.8125rem] text-text-muted">({xeroStats.totalReviews} verified reviews)</span>
        </div>
        <h2 class="section-heading">Rated 5/5 on the Xero App Store</h2>
        <p class="section-subheading mx-auto">
          Every single review is five stars. Here's what verified Xero users say.
        </p>
      </div>

      <!-- Review cards — scrollable on mobile, grid on desktop -->
      <div class="relative">
        <div class="flex gap-6 overflow-x-auto pb-4 snap-x snap-mandatory md:grid md:grid-cols-2 lg:grid-cols-4 md:overflow-visible md:pb-0 scrollbar-hide">
          {homepageReviews.map((r) => (
            <div class="flex-shrink-0 w-[85%] md:w-auto snap-start bg-white rounded-2xl border border-gray-100 p-6 shadow-sm flex flex-col">
              <!-- Stars -->
              <div class="flex items-center gap-0.5 mb-3">
                {[...Array(5)].map(() => (
                  <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                  </svg>
                ))}
              </div>
              <!-- Quote -->
              <p class="text-[0.875rem] text-text-body leading-relaxed flex-1 mb-4">
                "{r.quote}"
              </p>
              <!-- Attribution -->
              <div class="border-t border-gray-100 pt-3">
                <p class="text-[0.875rem] font-semibold text-text-heading">{r.name}</p>
                {(r.role || r.company) && (
                  <p class="text-[0.75rem] text-text-muted">{r.role ? `${r.role}, ${r.company}` : r.company}</p>
                )}
                <p class="text-[0.6875rem] text-text-muted mt-0.5">{r.date}</p>
              </div>
            </div>
          ))}
        </div>
      </div>

      <!-- Link to all reviews -->
      <div class="text-center mt-10">
        <a
          href={xeroStats.url}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-2 text-brand-green font-semibold text-[0.9375rem] hover:gap-3 transition-all duration-200"
        >
          Read all {xeroStats.totalReviews} reviews on the Xero App Store
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Section 6: Awards & Regulation -->
  <section class="section-padding-sm bg-[#F8FAFB] border-y border-gray-100">
    <div class="container-content">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-0 md:divide-x md:divide-gray-200">
        <!-- TMI Awards 2025 -->
        <div class="flex items-center gap-5 md:justify-center md:px-8">
          <img
            src="/assets/logos/clients/tmi.jpg"
            alt="TMI Awards 2025 for Innovation & Excellence"
            class="w-20 h-20 md:w-24 md:h-24 rounded-2xl object-cover flex-shrink-0"
          />
          <div>
            <p class="font-semibold text-text-heading text-[1rem]">Best Risk Management</p>
            <p class="text-[0.875rem] text-text-muted">TMI Awards 2025</p>
          </div>
        </div>

        <!-- TTP Awards 2026 -->
        <div class="flex items-center gap-5 md:justify-center md:px-8">
          <img
            src="/assets/logos/clients/ttp.jpg"
            alt="TTP Awards 2026"
            class="w-20 h-20 md:w-24 md:h-24 rounded-2xl object-cover flex-shrink-0"
          />
          <div>
            <p class="font-semibold text-text-heading text-[1rem]">SME Inclusion Initiative</p>
            <p class="text-[0.875rem] text-text-muted">TTP Awards 2026</p>
          </div>
        </div>

        <!-- FCA Badge -->
        <div class="flex items-center gap-5 md:justify-center md:px-8">
          <div class="w-20 h-20 md:w-24 md:h-24 bg-brand-green-pale rounded-2xl flex items-center justify-center flex-shrink-0">
            <svg class="w-10 h-10 md:w-12 md:h-12 text-brand-green" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
            </svg>
          </div>
          <div>
            <p class="font-semibold text-text-heading text-[1rem]">FCA Regulated</p>
            <p class="text-[0.875rem] text-text-muted">Firm Reference Number: 1008699</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 7: Latest Insights -->
  <section class="section-padding">
    <div class="container-content">
      <div class="flex items-end justify-between mb-12">
        <h2 class="section-heading">Latest insights</h2>
        <a href="/blog" class="hidden md:inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] hover:gap-2.5 transition-all duration-200">
          View all
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
      <div class="grid md:grid-cols-3 gap-6 lg:gap-8">
        {latestPosts.map((post) => (
          <BlogCard
            title={post.title}
            excerpt={post.excerpt}
            date={post.date}
            href={post.href}
            image={post.image}
          />
        ))}
      </div>
      <div class="mt-10 text-center md:hidden">
        <a href="/blog" class="btn-secondary">
          View all posts
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Section 8: Final CTA -->
  <CTASection
    headline="Ready to take control of your international finances?"
    primaryCta={{ label: 'Book a Treasury Review', href: '/treasury-health-check' }}
    secondaryCta={{ label: 'See the Platform', href: '/platform' }}
  />
</PageLayout>
