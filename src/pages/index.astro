---
import PageLayout from '../layouts/PageLayout.astro';
import Hero from '../components/Hero.astro';
import TrustBar from '../components/TrustBar.astro';
import StepProcess from '../components/StepProcess.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import BlogCard from '../components/BlogCard.astro';
import CTASection from '../components/CTASection.astro';
import { getTestimonials, getBlogPosts, getClientLogos, urlFor } from '../lib/sanity';
import { staticClientLogos } from '../data/clientLogos';

// Fetch from Sanity with fallbacks
let sanityTestimonials: any[] = [];
let sanityPosts: any[] = [];
let clientLogos: any[] = [];
try {
  sanityTestimonials = await getTestimonials(true) || [];
} catch (e) { /* fallback to hardcoded */ }
try {
  sanityPosts = await getBlogPosts(3) || [];
} catch (e) { /* fallback to hardcoded */ }
try {
  const sanityLogos = await getClientLogos() || [];
  clientLogos = sanityLogos.length > 0 ? sanityLogos : staticClientLogos;
} catch (e) {
  clientLogos = staticClientLogos;
}

const steps = [
  {
    number: 1,
    title: 'Connect your data',
    description: 'Link your Xero, NetSuite, QuickBooks, or Business Central in minutes.',
  },
  {
    number: 2,
    title: 'See your real picture',
    description: 'Understand your true FX costs, exposure, and cash position across all accounts.',
  },
  {
    number: 3,
    title: 'Get expert advice',
    description: 'Tailored strategy from advisors who\'ve managed treasury for the world\'s largest companies.',
  },
  {
    number: 4,
    title: 'Execute in one click',
    description: 'Act on recommendations directly in the platform — hedges, payments, and more.',
  },
];

const testimonials = [
  {
    quote: "HedgeFlows has made managing multi-currency payments and FX risk much easier. The automation around allocating hedges to invoices and making payments has cut out a lot of manual work. It's now a core part of how we run our finance operations.",
    personName: 'Nick',
    personRole: 'Finance Director',
    companyName: 'Pact Coffee',
  },
  {
    quote: "The HedgeFlows team were instrumental in helping us develop our treasury strategy. We appreciated that they didn't try to sell us their platform over other providers, but helped us find the best solution for our needs.",
    personName: 'Harry Young',
    personRole: 'Global Finance Director',
    companyName: 'Journey',
  },
  {
    quote: "HedgeFlows is a real game changer. It's saved us loads of time and effort, completely revolutionising how we handle payments. The outstanding support and quick response times truly set them apart.",
    personName: 'Mohammad',
    personRole: 'Finance Director',
    companyName: 'VogaCloset',
  },
];

const placeholderPosts = [
  {
    title: 'Understanding Hidden FX Costs in International Trade',
    excerpt: 'Most businesses don\'t realise how much their bank charges on currency conversions. Here\'s how to find out.',
    date: '2026-01-15',
    href: '/blog',
  },
  {
    title: 'Why Every International Business Needs a Treasury Health Check',
    excerpt: 'A treasury review can reveal significant savings opportunities. Learn what to expect from the process.',
    date: '2026-01-08',
    href: '/blog',
  },
  {
    title: 'FX Hedging for Mid-Market Businesses: A Practical Guide',
    excerpt: 'You don\'t need to be a FTSE 100 company to manage currency risk effectively. Here\'s how to start.',
    date: '2025-12-20',
    href: '/blog',
  },
];
---

<PageLayout
  title="HedgeFlows — Treasury Advisory & Technology"
  description="Expert treasury advisory and technology for businesses that trade internationally. FX risk management, cash management, and payments automation — without the cost of a full treasury function."
>
  <!-- Section 1: Hero -->
  <Hero
    title="Take control of your international finances — with a treasury team that scales with you"
    subtitle="Expert guidance on the international finance challenges your CEO is already asking about — plus the technology to act on it."
    primaryCta={{ label: 'Book a Treasury Review', href: '/treasury-health-check' }}
    secondaryCta={{ label: 'Connect Your Accounting System', href: '/platform' }}
    large={true}
  />

  <!-- Section 2: Trust Bar -->
  <TrustBar label="Trusted by international businesses:" logos={clientLogos} />

  <!-- Section 3: Product Suite — Advisory + Platform -->
  <section class="section-padding bg-[#F8FAFB]">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">
          A complete treasury function — without the full-time headcount
        </h2>
        <p class="section-subheading mx-auto">
          Expert advisory and purpose-built technology, working together.
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-6 lg:gap-8">
        <!-- Card 1: Treasury Advisory -->
        <a href="/treasury-advisory"
           class="group relative bg-white rounded-2xl border border-gray-100 overflow-hidden
                  shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                  hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                  hover:border-brand-green/20 transition-all duration-300 flex flex-col">
          <div class="p-8 lg:p-10 flex-1">
            <p class="text-[0.75rem] font-semibold text-brand-green uppercase tracking-wider mb-3">Treasury Advisory</p>
            <h3 class="text-[1.5rem] lg:text-[1.75rem] font-bold text-text-heading mb-3 leading-tight group-hover:text-brand-green transition-colors duration-200">
              Institutional-grade expertise for your business
            </h3>
            <p class="text-[0.9375rem] text-text-body leading-relaxed mb-6">
              Our advisors have managed treasury for the world's largest companies. Now they work for you — uncovering hidden costs, building hedging strategies, and optimising your banking relationships.
            </p>
            <ul class="space-y-3 mb-8">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">FX risk management & hedging programmes</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Bank relationship & cost optimisation</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Cash management & working capital</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Treasury policy & board-ready reporting</span>
              </li>
            </ul>
            <span class="inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] group-hover:gap-2.5 transition-all duration-200">
              Explore advisory
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </span>
          </div>
          <div class="mx-8 lg:mx-10 mb-8 lg:mb-10 rounded-xl overflow-hidden">
            <img
              src="/assets/images/advisory-team.jpg"
              alt="HedgeFlows treasury advisory team presenting at a client workshop"
              class="w-full h-48 lg:h-56 object-cover"
              loading="lazy"
            />
          </div>
        </a>

        <!-- Card 2: Treasury Platform -->
        <a href="/platform"
           class="group relative bg-white rounded-2xl border border-gray-100 overflow-hidden
                  shadow-[0_1px_3px_rgba(0,0,0,0.04),0_6px_24px_rgba(0,0,0,0.04)]
                  hover:shadow-[0_4px_12px_rgba(0,0,0,0.06),0_12px_40px_rgba(0,0,0,0.06)]
                  hover:border-brand-green/20 transition-all duration-300 flex flex-col">
          <div class="p-8 lg:p-10 flex-1">
            <p class="text-[0.75rem] font-semibold text-brand-green uppercase tracking-wider mb-3">Treasury Platform</p>
            <h3 class="text-[1.5rem] lg:text-[1.75rem] font-bold text-text-heading mb-3 leading-tight group-hover:text-brand-green transition-colors duration-200">
              See, manage, and act — in one place
            </h3>
            <p class="text-[0.9375rem] text-text-body leading-relaxed mb-6">
              Connect your accounting system and get real-time visibility into FX exposure, cash positions, and payment flows. Then act on expert recommendations directly in the platform.
            </p>
            <ul class="space-y-3 mb-8">
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">FX exposure tracking & automated hedging</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Multi-currency payments & collections</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Cash position dashboard across all accounts</span>
              </li>
              <li class="flex items-start gap-3">
                <svg class="w-5 h-5 text-brand-green flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
                <span class="text-[0.9375rem] text-text-body">Xero, NetSuite, QuickBooks & Business Central</span>
              </li>
            </ul>
            <span class="inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] group-hover:gap-2.5 transition-all duration-200">
              Explore platform
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
              </svg>
            </span>
          </div>
          <div class="mx-8 lg:mx-10 mb-8 lg:mb-10 rounded-xl overflow-hidden border border-gray-200 shadow-sm">
            <img
              src="/assets/images/dashboard.png"
              alt="HedgeFlows treasury dashboard showing cash positions, FX exposure, and payment flows"
              class="w-full h-auto"
              loading="lazy"
            />
          </div>
        </a>
      </div>
    </div>
  </section>

  <!-- Section 4: How It Works -->
  <section class="section-padding bg-[#F8FAFB]">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">How it works</h2>
      </div>
      <StepProcess steps={steps} />
    </div>
  </section>

  <!-- Section 5: Social Proof -->
  <section class="section-padding">
    <div class="container-content">
      <div class="text-center mb-14">
        <h2 class="section-heading">What our clients say</h2>
      </div>
      <div class="grid md:grid-cols-3 gap-6 lg:gap-8">
        {(sanityTestimonials.length > 0 ? sanityTestimonials : testimonials).map((t: any) => (
          <TestimonialCard
            quote={t.quote}
            personName={t.personName}
            personRole={t.personRole}
            companyName={t.companyName}
          />
        ))}
      </div>
    </div>
  </section>

  <!-- Section 6: Awards & Regulation -->
  <section class="section-padding-sm bg-[#F8FAFB] border-y border-gray-100">
    <div class="container-content">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-0 md:divide-x md:divide-gray-200">
        <!-- TMI Awards 2025 -->
        <div class="flex items-center gap-4 md:justify-center md:px-8">
          <img
            src="/assets/logos/clients/tmi.jpg"
            alt="TMI Awards 2025 for Innovation & Excellence"
            class="w-16 h-16 rounded-2xl object-cover flex-shrink-0"
          />
          <div>
            <p class="font-semibold text-text-heading text-[0.9375rem]">Best Risk Management</p>
            <p class="text-[0.8125rem] text-text-muted">TMI Awards 2025</p>
          </div>
        </div>

        <!-- TTP Awards 2026 -->
        <div class="flex items-center gap-4 md:justify-center md:px-8">
          <img
            src="/assets/logos/clients/ttp.jpg"
            alt="TTP Awards 2026"
            class="w-16 h-16 rounded-2xl object-cover flex-shrink-0"
          />
          <div>
            <p class="font-semibold text-text-heading text-[0.9375rem]">SME Inclusion Initiative</p>
            <p class="text-[0.8125rem] text-text-muted">TTP Awards 2026</p>
          </div>
        </div>

        <!-- FCA Badge -->
        <div class="flex items-center gap-4 md:justify-center md:px-8">
          <div class="w-16 h-16 bg-brand-green-pale rounded-2xl flex items-center justify-center flex-shrink-0">
            <svg class="w-8 h-8 text-brand-green" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
            </svg>
          </div>
          <div>
            <p class="font-semibold text-text-heading text-[0.9375rem]">FCA Regulated</p>
            <p class="text-[0.8125rem] text-text-muted">Firm Reference Number: 1008699</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Section 7: Latest Insights -->
  <section class="section-padding">
    <div class="container-content">
      <div class="flex items-end justify-between mb-12">
        <h2 class="section-heading">Latest insights</h2>
        <a href="/blog" class="hidden md:inline-flex items-center gap-1.5 text-brand-green font-semibold text-[0.9375rem] hover:gap-2.5 transition-all duration-200">
          View all
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
      <div class="grid md:grid-cols-3 gap-6 lg:gap-8">
        {sanityPosts.length > 0 ? (
          sanityPosts.map((post: any) => (
            <BlogCard
              title={post.title}
              excerpt={post.excerpt || ''}
              date={post.publishedAt || new Date().toISOString()}
              href={`/blog/${post.slug?.current}`}
              image={post.featuredImage ? urlFor(post.featuredImage).width(600).height(375).auto('format').url() : undefined}
            />
          ))
        ) : (
          placeholderPosts.map((post) => (
            <BlogCard
              title={post.title}
              excerpt={post.excerpt}
              date={post.date}
              href={post.href}
            />
          ))
        )}
      </div>
      <div class="mt-10 text-center md:hidden">
        <a href="/blog" class="btn-secondary">
          View all posts
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Section 8: Final CTA -->
  <CTASection
    headline="Ready to take control of your international finances?"
    primaryCta={{ label: 'Book a Treasury Review', href: '/treasury-health-check' }}
    secondaryCta={{ label: 'Connect Your Accounting System', href: '/platform' }}
  />
</PageLayout>
