---
export const prerender = false;

import PageLayout from '../../layouts/PageLayout.astro';
import PortableText from '../../components/PortableText.astro';
import { getFxAcademyModule, urlFor } from '../../lib/sanity';

const { slug } = Astro.params;
const mod = await getFxAcademyModule(slug || '');

if (!mod) {
  return Astro.redirect('/404');
}
---

<PageLayout
  title={mod.seoTitle || `${mod.title} â€” FX Academy`}
  description={mod.seoDescription || mod.description}
>
  <section class="section-padding">
    <div class="container-content max-w-3xl mx-auto">
      {/* Breadcrumb */}
      <nav class="mb-8 text-[0.875rem] text-text-muted">
        <a href="/fx-academy" class="hover:text-brand-green transition-colors">FX Academy</a>
        <span class="mx-2">/</span>
        <span class="text-text-heading font-medium">Module {mod.moduleNumber}</span>
      </nav>

      {mod.moduleNumber && (
        <span class="inline-block bg-brand-green text-white text-[0.8125rem] font-bold px-3 py-1 rounded-full mb-4">
          Module {mod.moduleNumber}
        </span>
      )}

      <h1 class="text-[2rem] md:text-[2.5rem] font-bold text-text-heading leading-tight mb-4">
        {mod.title}
      </h1>

      {mod.description && (
        <p class="text-[1.125rem] text-text-body leading-relaxed mb-10">
          {mod.description}
        </p>
      )}

      {mod.featuredImage && (
        <img
          src={urlFor(mod.featuredImage).width(800).auto('format').url()}
          alt={mod.title}
          class="w-full rounded-xl shadow-md mb-10"
          loading="eager"
        />
      )}

      <PortableText value={mod.body} />

      {mod.relatedGlossaryTerms && mod.relatedGlossaryTerms.length > 0 && (
        <div class="mt-12 pt-8 border-t border-gray-100">
          <h2 class="text-[1.125rem] font-semibold text-text-heading mb-4">Key terms from this module</h2>
          <div class="flex flex-wrap gap-2">
            {mod.relatedGlossaryTerms.map((t: any) => (
              <a
                href={`/glossary/${t.slug?.current}`}
                class="px-4 py-2 bg-brand-green-pale text-brand-green text-[0.9375rem] font-medium rounded-full
                       hover:bg-brand-green hover:text-white transition-colors"
              >
                {t.term}
              </a>
            ))}
          </div>
        </div>
      )}

      <div class="mt-12">
        <a href="/fx-academy" class="inline-flex items-center gap-2 text-brand-green font-semibold hover:gap-3 transition-all">
          <svg class="w-4 h-4 rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
          </svg>
          Back to FX Academy
        </a>
      </div>
    </div>
  </section>
</PageLayout>
